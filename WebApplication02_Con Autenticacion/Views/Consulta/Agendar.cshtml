@{
    ViewBag.Title = "Agendar Cita Médica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Agendar Cita</h2>

<!-- Formulario principal -->
@using (Html.BeginForm("Agendar", "Consulta", FormMethod.Get))
{
    <div class="form-group mb-3">
        <label>Especialidad</label>
        @Html.DropDownList("idEspecialidad", ViewBag.Especialidades as SelectList, "Seleccione...",
            new { @class = "form-control", onchange = "this.form.submit();" })
    </div>

    <div class="form-group mb-3">
        <label>Médico</label>
        @Html.DropDownList("idMedico", ViewBag.Medicos as SelectList, "Seleccione...",
            new { @class = "form-control", onchange = "this.form.submit();" })
    </div>

    <div class="form-group mb-3">
        <label>Fecha</label>
        <input type="date" name="fecha" value="@ViewBag.FechaSeleccionada"
               class="form-control" onchange="this.form.submit();" />
    </div>
}

@{
    var horarios = ViewBag.Horarios as List<string>;
}

@if (horarios != null && horarios.Count > 0)
{
    <h4 class="mt-4">Horarios Disponibles</h4>

    using (Html.BeginForm("AgendarConfirmado", "Consulta", FormMethod.Post))
    {
        @Html.Hidden("IdEspecialidad", Request["idEspecialidad"])
        @Html.Hidden("IdMedico", Request["idMedico"])
        @Html.Hidden("FechaConsulta", Request["fecha"])

        <div class="form-group mb-3">
            <label>Seleccione horario</label>
            <select class="form-control" name="HI" required>
                @foreach (var h in horarios)
                {
                    <option value="@h">@h</option>
                }
            </select>
        </div>

        <button class="btn btn-primary mt-2" type="submit">Confirmar Cita</button>
    }
}
else if (Request["idMedico"] != null && Request["fecha"] != null)
{
    <div class="alert alert-warning mt-4">
        No hay horarios disponibles para la fecha seleccionada.
    </div>
}
